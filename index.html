<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文字生存：荒野 (RPG完整版)</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="app-container">
        
        <header class="top-bar">
            <div class="loc-info">
                <span>孤岛: <b id="loc-name">戈壁</b> [<span id="coord">11,3</span>]</span>
                <span class="mini-map-btn" onclick="openMap()">小地图</span>
            </div>
            <div class="time-info">1000年03月01日 <span id="clock-time">08:00</span></div>

            <div class="stats-grid">
                <span>LV: <b id="header-lv">1</b>(<span id="header-pct">0%</span>)</span>
                <span>EXP: <b id="header-exp">0</b>/<span id="header-max-exp">10</span></span>
                
                <span class="stat-sanity">理智: <b id="sanity">100</b>/100</span>
                <span class="stat-hp">HP: <b id="hp">100</b>/<span id="header-max-hp">100</span></span>
                <span class="stat-hunger">饥饿: <b id="hunger">100</b>/<span id="header-max-hunger">100</span></span>
                <span class="stat-water">水分: <b id="water">100</b>/<span id="header-max-water">100</span></span>
            </div>

        </header>

        <div class="season-bar">
            <div class="season-box">春</div>
            <div class="weather-box">日</div>
        </div>

         <div class="survive-bar">
            <span id="boss-status-wither">存活: 凋灵</span>
            <span id="boss-status-dragon">存活: 末影龙</span>
        </div>

    <div class="quest-book-btn" onclick="openQuestModal()">
        <img src="https://zh.minecraft.wiki/images/Enchanted_Book.gif?5e683" alt="任务">
    </div>

    <div id="quest-modal" class="modal hidden">
        <div class="modal-content quest-panel">
            <div class="quest-header">冒险指南</div>
            <div class="quest-body">
                <h3 id="quest-title">任务标题</h3>
                <div id="quest-desc" class="quest-text">任务描述内容...</div>
                
                <div class="quest-rewards">
                    <p>任务奖励:</p>
                    <div id="quest-reward-list"></div>
                </div>
            </div>
            <div class="quest-footer">
                <button id="btn-claim-quest" class="menu-btn save" onclick="checkAndClaimQuest()">领取奖励 / 下一步</button>
                <button class="menu-btn" onclick="closeQuestModal()">关闭</button>
            </div>
        </div>
    </div>


        <main class="content-area">
            
            <div id="scene-view">
                <div id="scene-grid" class="item-grid"></div>
            </div>

            <div id="inventory-view" class="view-container hidden">
                <div class="inv-header">
                    <button class="close-inv-btn" onclick="switchView('scene')">╳ 关闭</button>
                    角色详情
                </div>
                
                <div class="inv-tabs">
                    <button class="inv-tab-btn active" onclick="switchInvTab('stats')">属性/物品</button>
                    <button class="inv-tab-btn" onclick="switchInvTab('equip')">装备/工具</button>
                </div>

                <div id="inv-tab-stats" class="inv-content stat-panel">
                    <div class="level-badge">
                        <div style="font-size:24px; font-weight:bold;">LV. <span id="stat-lv">1</span></div>
                        <div style="font-size:12px; opacity:0.9; margin-top:5px;">
                            经验值: <span id="stat-exp">0</span> / <span id="stat-max-exp">10</span>
                        </div>
                        <div style="height:6px; background:rgba(0,0,0,0.2); border-radius:3px; margin-top:8px; overflow:hidden;">
                            <div id="stat-exp-bar" style="height:100%; width:0%; background:#fff;"></div>
                        </div>
                        <div style="margin-top:10px; font-size:13px; font-weight:bold;">
                            可用点数: <span id="stat-points" style="background:rgba(255,255,255,0.3); padding:2px 8px; border-radius:10px;">0</span>
                        </div>
                    </div>

                    <div class="stat-list">
                        <div class="stat-row">
                            <span class="stat-label">生命</span>
                            <div style="display:flex; align-items:center;">
                                <span class="stat-val"><span id="val-hp">100</span> / <span id="val-max-hp">100</span></span>
                                <button class="plus-btn" id="btn-add-hp" onclick="addPoint('hp')">+</button>
                            </div>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">饥饿</span>
                            <div style="display:flex; align-items:center;">
                                <span class="stat-val" id="val-max-hunger">100</span>
                                <button class="plus-btn" id="btn-add-hunger" onclick="addPoint('hunger')">+</button>
                            </div>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">水分</span>
                            <div style="display:flex; align-items:center;">
                                <span class="stat-val" id="val-max-water">100</span>
                                <button class="plus-btn" id="btn-add-water" onclick="addPoint('water')">+</button>
                            </div>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">攻击</span>
                            <span class="stat-val" id="val-atk">5</span>
                        </div>
                         <div class="stat-row">
                            <span class="stat-label">理智</span>
                            <span class="stat-val" id="val-sanity">100</span>
                        </div>
                    </div>

                    <div style="margin-top: 20px; border-top: 2px solid #eee; padding-top: 10px;">
                        <div class="category-tabs" style="margin-bottom:10px;">
                            <button class="tab-btn active" onclick="setInvFilter('food', this)">食物/药物</button>
                            <button class="tab-btn" onclick="setInvFilter('material', this)">材料/杂物</button>
                        </div>
                        <div id="inventory-list-stats" class="list-container"></div>
                    </div>
                </div>

                <div id="inv-tab-equip" class="inv-content hidden">
                    <div class="equip-slots">
                        <div class="equip-slot">
                            <span>主手武器/工具</span>
                            <div id="slot-weapon" style="color:#e74c3c">无</div>
                        </div>
                        <div class="equip-slot">
                            <span>身体防具</span>
                            <div id="slot-armor" style="color:#3498db">无</div>
                        </div>
                    </div>

                    <div style="margin-top:10px; padding:10px; background:#f9f9f9; font-size:12px; color:#666; text-align:center;">
                        ↓ 点击下方装备进行穿戴 ↓
                    </div>
                    
                    <div id="inventory-list-equip" class="list-container"></div>
                </div>
            </div>

            <div id="craft-view" class="view-container hidden">
                <div class="view-title">生存制作</div>
                <div class="category-tabs">
                    <button class="tab-btn active" onclick="setCraftFilter('all', this)">全部</button>
                    <button class="tab-btn" onclick="setCraftFilter('equip', this)">武器/防具</button>
                    <button class="tab-btn" onclick="setCraftFilter('food', this)">烹饪/料理</button>
                    <button class="tab-btn" onclick="setCraftFilter('build', this)">建筑/工具</button>
                </div>
                <div id="craft-list" class="list-container"></div>
            </div>

            <div id="combat-view" class="view-container hidden">
                <div class="combat-arena">
                    <div class="enemy-box">
                        <div id="enemy-name" class="enemy-title"></div>
                        <div class="hp-bar-bg"><div id="enemy-hp-bar" class="hp-bar-fill"></div></div>
                        <div id="enemy-stats" class="enemy-text">HP: ??/??</div>
                    </div>

                    <div class="combat-log" id="combat-log-area"></div>

                    <div class="player-actions">
                        <button class="atk-btn" onclick="combatAttack()">⚔️ 攻击</button>
                        <button class="flee-btn" onclick="combatFlee()">🏃 逃跑</button>
                    </div>
                </div>
            </div>

            <div id="chest-view" class="view-container hidden">
                <div class="view-title">储物箱 <button class="small-btn" onclick="closeBuilding()">关闭</button></div>
                <div style="display:flex; justify-content:space-between; margin-bottom:5px; font-size:12px; color:#666;">
                    <span>我的背包</span> <span>箱子空间</span>
                </div>
                <div class="chest-layout">
                    <div id="chest-player-inv" class="list-container half-list"></div>
                    <div id="chest-storage" class="list-container half-list"></div>
                </div>
            </div>

            <div id="furnace-view" class="view-container hidden">
                <div class="view-title">熔炉 (烧炼) <button class="small-btn" onclick="closeBuilding()">关闭</button></div>
                <div id="furnace-list" class="list-container"></div>
            </div>

            <div id="enchant-view" class="view-container hidden">
                <div class="view-title">附魔台 (强化) <button class="small-btn" onclick="closeBuilding()">关闭</button></div>
                <div id="enchant-list" class="list-container"></div>
            </div>

            <div id="trade-view" class="view-container hidden">
                <div class="view-title">村民交易 <button class="small-btn" onclick="switchView('scene')">离开</button></div>
                <div class="trade-header" style="padding:10px; background:#f9f9f9; border-bottom:1px solid #eee; font-size:12px; color:#555; margin-bottom:10px; display:flex; justify-content:space-between;">
                    <span>我的绿宝石: <b id="trade-emerald-count" style="color:#2ecc71; font-size:14px;">0</b></span>
                </div>
                <div id="trade-list" class="list-container"></div>
            </div>

            <div id="system-view" class="view-container hidden">
                <div class="view-title">系统菜单</div>
                <div style="padding: 20px; display: flex; flex-direction: column; gap: 15px;">
                    <div style="background: #e8f8f5; padding: 10px; border-radius: 5px; font-size: 12px; color: #555; border: 1px solid #d1f2eb;">
                        <p style="margin:0;">当前存档状态: <b id="save-status">Checking...</b></p>
                    </div>
                    <button class="menu-btn save" onclick="saveGame()">💾 保存进度 (Save)</button>
                    <button class="menu-btn load" onclick="loadGame()">📂 读取进度 (Load)</button>
                    <hr style="width: 100%; border: 0; border-top: 1px solid #eee;">
                    <button class="menu-btn danger" onclick="resetGame()">⚠️ 删档重开 (Reset)</button>
                    <div style="font-size: 10px; color: #999; text-align: center; margin-top: 20px;">
                        文字生存：荒野 v1.4<br>Local Storage System
                    </div>
                </div>
            </div>

            <div id="portal-view" class="view-container hidden">
                <div class="view-title">
                    末地祭坛 
                    <button class="small-btn" onclick="switchView('scene')">离开</button>
                </div>
                
                <div style="text-align:center; margin-top:10px; color:#aaa; font-size:12px;">
                    <p>点击空框架放入 [末影之眼]</p>
                    <p style="color:#e74c3c; font-size:10px;">(集齐9个激活传送门)</p>
                </div>

                <div id="portal-grid" class="portal-layout">
                    </div>
            </div>

        </main>

        <div class="log-area" id="game-log">
            <p>系统初始化完成...</p>
        </div>

        <div class="control-panel">
            <div class="d-pad-map">
                <div class="d-cell empty"></div>
                <div class="d-cell dir-btn" id="dir-n" onclick="move(0, -1)">北</div>
                <div class="d-cell empty"></div>
                <div class="d-cell dir-btn" id="dir-w" onclick="move(-1, 0)">西</div>
                <div class="d-cell current-loc" id="dir-c">我</div>
                <div class="d-cell dir-btn" id="dir-e" onclick="move(1, 0)">东</div>
                <div class="d-cell empty"></div>
                <div class="d-cell dir-btn" id="dir-s" onclick="move(0, 1)">南</div>
                <div class="d-cell empty"></div>
            </div>

            <div class="action-buttons">
                <button class="func-btn" onclick="search()" style="flex: 1; background-color: #f1c40f; color: #333; font-weight: bold;">
                    🔍 探索周围
                </button>
            </div>

        </div>

        <nav class="bottom-nav">
            <div class="nav-item" onclick="switchView('inventory')">
                <img src="https://zh.minecraft.wiki/images/Chest_JE2_BE3.gif?4e19c" class="nav-icon">
                <span>背包</span>
            </div>
            <div class="nav-item" onclick="switchView('craft')">
                <img src="https://zh.minecraft.wiki/images/Crafting_Table_JE4_BE3.png" class="nav-icon">
                <span>制作</span>
            </div>
            <div class="nav-item active" onclick="switchView('scene')">
                <img src="https://zh.minecraft.wiki/images/Grass_Block_JE7_BE6.png" class="nav-icon">
                <span>探索</span>
            </div>
            <div class="nav-item" onclick="openMap()">
                <img src="https://zh.minecraft.wiki/images/Invicon_Locked_Map.png?af5e7" class="nav-icon">
                <span>地图</span>
            </div>
            <div class="nav-item" onclick="switchView('system')">
                <img src="https://zh.minecraft.wiki/images/Impulse_Command_Block.gif?e65a3" class="nav-icon">
                <span>系统/存档</span>
            </div>
        </nav>

    </div>

    <div id="map-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">关闭地图</div>
            <div class="big-map-container">
                <div id="big-grid" class="big-grid"></div> 
            </div>
            <div class="modal-footer" onclick="closeMap()">点击此处返回</div>
            <div class="map-controls">
                <button>还原</button><button>放大</button><button>缩小</button><button>传送</button>
            </div>
        </div>
    </div>

    <script src="items.js"></script>
    <script src="script.js"></script>
</body>
</html>
