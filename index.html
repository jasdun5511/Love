<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>孤岛生存 - 简易版</title>
  <style>
    :root{--bg:#f7f7f7;--panel:#fff;--accent:#6bb07a}
    body{font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:0;background:var(--bg);color:#222}
    .top{background:var(--panel);padding:10px 14px;border-bottom:1px solid #e6e6e6;display:flex;align-items:center;gap:18px}
    .stats{display:flex;gap:10px;align-items:center}
    .stat{font-size:13px}
    .container{max-width:960px;margin:18px auto;padding:14px}
    .map{display:grid;grid-template-columns:repeat(11,36px);grid-auto-rows:36px;gap:2px;background:#ddd;padding:6px;border-radius:6px}
    .cell{width:36px;height:36px;display:flex;align-items:center;justify-content:center;font-size:11px;border-radius:4px;background:#fff;box-shadow:0 0 0 1px rgba(0,0,0,0.02) inset}
    .cell.grass{background:#d9f0d9}
    .cell.desert{background:#fff0c2}
    .cell.mountain{background:#f0e6d9;color:#8b5}
    .cell.wall{background:#e6e6e6}
    .cell.water{background:#dff0ff}
    .cell.player{background:#55a; color:#fff}
    .controls{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
    button{padding:8px 10px;border-radius:6px;border:1px solid #ccc;background:#fff;cursor:pointer}
    button.primary{background:var(--accent);color:#fff;border-color:transparent}
    .log{margin-top:12px;background:#fff;padding:10px;border-radius:6px;min-height:80px;max-height:180px;overflow:auto;font-size:13px}
    .resources{display:flex;gap:8px;margin-top:12px}
    .resource{background:#fff;padding:6px 8px;border-radius:6px;border:1px solid #eee}
    @media (max-width:520px){.map{grid-template-columns:repeat(11,28px);grid-auto-rows:28px}.cell{width:28px;height:28px;font-size:10px}}
  </style>
</head>
<body>
  <div class="top">
    <div style="font-weight:700">孤岛生存（简易）</div>
    <div class="stats">
      <div class="stat">LV: <span id="lv">1</span></div>
      <div class="stat">HP: <span id="hp">100</span>/100</div>
      <div class="stat">饥饿: <span id="hung">100</span>/100</div>
      <div class="stat">水分: <span id="water">100</span>/100</div>
      <div class="stat">负重: <span id="load">0</span>/20</div>
    </div>
  </div>

  <div class="container">
    <div style="display:flex;gap:18px;align-items:flex-start">
      <div>
        <div class="map" id="map"></div>
        <div class="controls">
          <button id="up">↑</button>
          <button id="left">←</button>
          <button id="down">↓</button>
          <button id="right">→</button>
          <button id="explore">探索</button>
          <button id="gather">采集</button>
          <button id="save">保存</button>
          <button id="load">读取</button>
        </div>
      </div>
      <div style="flex:1;min-width:220px">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div style="font-weight:600">信息面板</div>
          <div style="font-size:12px;color:#666">使用方向键或按钮移动</div>
        </div>
        <div class="resources" id="resources"></div>
        <div class="log" id="log"></div>
      </div>
    </div>
  </div>

<script>
  // 简易游戏数据
  const SIZE = 11;
  const mapEl = document.getElementById('map');
  const logEl = document.getElementById('log');
  const resourcesEl = document.getElementById('resources');

  const types = ['grass','desert','mountain','water','wall'];

  let state = {
    player:{x:Math.floor(SIZE/2),y:Math.floor(SIZE/2)},
    hp:100,hunger:100,water:100,lv:1,load:0,inventory:{'草':3},
    tiles:[],time:0
  };

  function randChoice(arr){return arr[Math.floor(Math.random()*arr.length)];}

  function genMap(seed=false){
    const tiles = [];
    for(let y=0;y<SIZE;y++){
      const row = [];
      for(let x=0;x<SIZE;x++){
        let t = 'grass';
        const d = Math.abs(x-SIZE/2)+Math.abs(y-SIZE/2);
        if(d>5 && Math.random()<0.6) t = randChoice(types);
        else if(Math.random()<0.12) t = 'mountain';
        if(x===state.player.x && y===state.player.y) t='player';
        row.push({type:t,items:generateItemsFor(t)});
      }
      tiles.push(row);
    }
    return tiles;
  }

  function generateItemsFor(type){
    if(type==='grass') return {'草': Math.random() < 0.6 ? 1 + Math.floor(Math.random()*3) : 0};
    if(type==='desert') return {'石': Math.random() < 0.3 ? 1 + Math.floor(Math.random()*2) : 0};
    if(type==='mountain') return {'矿石': Math.random() < 0.6 ? 1 + Math.floor(Math.random()*3) : 0};
    return {};
  }

  function render(){
    mapEl.innerHTML='';
    for(let y=0;y<SIZE;y++){
      for(let x=0;x<SIZE;x++){
        const c = document.createElement('div');
        c.className='cell';
        let t = state.tiles[y][x].type;
        if(state.player.x===x && state.player.y===y) t='player';
        c.classList.add(t);
        c.textContent = tileLabel(t,state.tiles[y][x]);
        c.addEventListener('click',()=>{ log('点击格子 '+x+','+y+' 类型:'+t); });
        mapEl.appendChild(c);
      }
    }
    document.getElementById('hp').textContent=state.hp;
    document.getElementById('hung').textContent=state.hunger;
    document.getElementById('water').textContent=state.water;
    document.getElementById('lv').textContent=state.lv;
    document.getElementById('load').textContent=state.load;
    renderResources();
  }

  function tileLabel(tileType,tile){
    if(tileType==='player') return '我';
    if(tileType==='grass') return '草';
    if(tileType==='desert') return '沙';
    if(tileType==='mountain') return '山';
    if(tileType==='water') return '水';
    if(tileType==='wall') return '';
    return '';
  }

  function move(dx,dy){
    const nx = state.player.x+dx, ny = state.player.y+dy;
    if(nx<0||nx>=SIZE||ny<0||ny>=SIZE) { log('不能移动出地图。'); return; }
    const dest = state.tiles[ny][nx].type;
    if(dest==='wall') { log('这里无法通过。'); return; }
    state.player.x=nx; state.player.y=ny;
    state.time += 1; tickAfterMove(); render();
    log('移动到 '+nx+','+ny+' ('+dest+')');
  }

  function tickAfterMove(){
    state.hunger = Math.max(0,state.hunger-2);
    state.water = Math.max(0,state.water-1);
    if(state.hunger===0||state.water===0) state.hp = Math.max(0,state.hp-5);
    // 自动拾取少量
    const tile = state.tiles[state.player.y][state.player.x];
    for(const k in tile.items){
      if(tile.items[k]>0){
        const take = Math.min(tile.items[k],1);
        addToInv(k,take);
        tile.items[k]-=take;
        log('自动拾取: '+k+' x'+take);
      }
    }
  }

  function explore(){
    const tile = state.tiles[state.player.y][state.player.x];
    if(Math.random()<0.2){
      log('你发现了一个小补给箱: 食物x2'); addToInv('食物',2); return;
    }
    if(Math.random()<0.15){
      log('遭遇小怪！ 战斗中受伤 -5HP'); state.hp=Math.max(0,state.hp-5); return;
    }
    log('没有发现特殊事件。');
  }

  function gather(){
    const tile = state.tiles[state.player.y][state.player.x];
    let found=false;
    for(const k in tile.items){
      if(tile.items[k]>0){
        const amount = tile.items[k];
        addToInv(k,amount);
        log('采集到: '+k+' x'+amount);
        tile.items[k]=0; found=true; state.time+=1; break;
      }
    }
    if(!found) log('这里没有可采集的资源。');
    render();
  }

  function addToInv(name,qty){
    state.inventory[name] = (state.inventory[name]||0)+qty;
    state.load += qty; if(state.load>20) log('负重过高，行动会受限。');
    renderResources();
  }

  function renderResources(){
    resourcesEl.innerHTML='';
    for(const k in state.inventory){
      const d = document.createElement('div'); d.className='resource'; d.textContent=k+': '+state.inventory[k];
      resourcesEl.appendChild(d);
    }
  }

  function save(){ localStorage.setItem('island_save',JSON.stringify(state)); log('已保存到本地。'); }
  function load(){ const s=localStorage.getItem('island_save'); if(!s){log('没有存档');return;} state=JSON.parse(s); log('读取本地存档。'); render(); }

  function log(s){ const p=document.createElement('div'); p.textContent=(new Date().toLocaleTimeString())+' '+s; logEl.prepend(p); }

  // 绑定按钮
  document.getElementById('up').addEventListener('click',()=>move(0,-1));
  document.getElementById('down').addEventListener('click',()=>move(0,1));
  document.getElementById('left').addEventListener('click',()=>move(-1,0));
  document.getElementById('right').addEventListener('click',()=>move(1,0));
  document.getElementById('explore').addEventListener('click',explore);
  document.getElementById('gather').addEventListener('click',gather);
  document.getElementById('save').addEventListener('click',save);
  document.getElementById('load').addEventListener('click',load);

  // 键盘移动
  window.addEventListener('keydown',e=>{
    if(['ArrowUp','w'].includes(e.key)) move(0,-1);
    if(['ArrowDown','s'].includes(e.key)) move(0,1);
    if(['ArrowLeft','a'].includes(e.key)) move(-1,0);
    if(['ArrowRight','d'].includes(e.key)) move(1,0);
  });

  // 初始化
  state.tiles = genMap();
  render();
  log('游戏已准备。欢迎来到孤岛。');

</script>
</body>
</html>
